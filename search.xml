<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>基于Qt的简单动态库的编写与调用</title>
      <link href="/2024/08/06/%E5%9F%BA%E4%BA%8EQt%E7%9A%84%E7%AE%80%E5%8D%95%E5%8A%A8%E6%80%81%E5%BA%93%E7%9A%84%E7%BC%96%E5%86%99%E4%B8%8E%E8%B0%83%E7%94%A8/"/>
      <url>/2024/08/06/%E5%9F%BA%E4%BA%8EQt%E7%9A%84%E7%AE%80%E5%8D%95%E5%8A%A8%E6%80%81%E5%BA%93%E7%9A%84%E7%BC%96%E5%86%99%E4%B8%8E%E8%B0%83%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="1-编写库"><a href="#1-编写库" class="headerlink" title="1 编写库"></a>1 编写库</h1><h2 id="1-1-库的入门"><a href="#1-1-库的入门" class="headerlink" title="1.1 库的入门"></a>1.1 库的入门</h2><h3 id="1-1-1-创建一个库"><a href="#1-1-1-创建一个库" class="headerlink" title="1.1.1 创建一个库"></a>1.1.1 创建一个库</h3><p>1、<strong>在Qt creator</strong>中自动创建，选择<strong>Library</strong></p><p><img src="https://1807962239hml-1324287819.cos.ap-beijing.myqcloud.com/202408060848977.png"></p><p>2、选择安装位置及项目名称</p><p>3、因为正在练习<strong>CMake</strong>，所以选择<strong>CMake</strong>为构建方式</p><p><img src="https://1807962239hml-1324287819.cos.ap-beijing.myqcloud.com/202408060852619.png"></p><p>4、继续选择是<strong>动态库、静态库还是插件</strong>；选择库中第一个类的名称，以及选择需要包含的Qt组件</p><ul><li>这里创建的<strong>动态库</strong></li></ul><p><img src="https://1807962239hml-1324287819.cos.ap-beijing.myqcloud.com/202408060856903.png"></p><p>5、后续Kits等基本选择默认设置就可以</p><h3 id="1-1-2-库的目录结构"><a href="#1-1-2-库的目录结构" class="headerlink" title="1.1.2 库的目录结构"></a>1.1.2 库的目录结构</h3><p>以下为一个用CMake构建的简单库的主要目录结构</p><p><img src="https://1807962239hml-1324287819.cos.ap-beijing.myqcloud.com/202408060905999.png"></p><p>1、<strong>CMakeLists.txt</strong>是构建项目的配置文件</p><p>2、<strong>MyLibrary_global.h</strong>是全局头文件，用来定义库的一些<strong>基本配置、宏、类型定义等</strong></p><p>3、剩下是库的<strong>头文件和源文件</strong></p><h2 id="1-2-具体代码及解析"><a href="#1-2-具体代码及解析" class="headerlink" title="1.2 具体代码及解析"></a>1.2 具体代码及解析</h2><h3 id="1-2-1-CMakeLists-txt"><a href="#1-2-1-CMakeLists-txt" class="headerlink" title="1.2.1 CMakeLists.txt"></a>1.2.1 CMakeLists.txt</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">#设置需要的cmake的最小版本</span><br><span class="line"></span><br><span class="line">cmake_minimum_required(VERSION <span class="number">3.5</span>)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">#设置项目名称</span><br><span class="line"></span><br><span class="line">project(MyLibrary LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">#设置一些基础变量</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_INCLUDE_CURRENT_DIR ON)</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_AUTOUIC ON)</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_AUTOMOC ON)</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_AUTORCC ON)</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_CXX_STANDARD_REQUIRED ON)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#找Qt5中的Widgets组件</span><br><span class="line">#COMPONENTS关键字代表找特定的组件</span><br><span class="line">#REQUIRED关键字代表组件是必须的，没有找到会直接构建失败</span><br><span class="line"></span><br><span class="line">find_package(Qt5 COMPONENTS Widgets REQUIRED)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">#添加库中所包含的文件</span><br><span class="line"></span><br><span class="line">add_library(MyLibrary SHARED</span><br><span class="line"></span><br><span class="line">  MyLibrary_global.h</span><br><span class="line"></span><br><span class="line">  mylibrary.cpp</span><br><span class="line"></span><br><span class="line">  mylibrary.h</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#设置安装前缀</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_INSTALL_PREFIX <span class="string">&quot;/home/hml/文档/test&quot;</span>)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">#file（GLOB 变量名 某路径下的某格式） 这里的路径默认为当前项目目录</span></span><br><span class="line">#将项目目录中的头文件存到HEADER_FILES变量中</span><br><span class="line"></span><br><span class="line">file(GLOB HEADER_FILES <span class="string">&quot;*.h&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#将当前库MyLibrary与其他库链接 PRIVATE关键字代表链接信息只对当前目标有效，不会传递</span><br><span class="line"></span><br><span class="line">target_link_libraries(MyLibrary PRIVATE Qt5::Widgets)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#定义一个预处理宏MYLIBRARY_LIBRARY只对目标MyLibrary有效</span><br><span class="line"></span><br><span class="line">target_compile_definitions(MyLibrary PRIVATE MYLIBRARY_LIBRARY)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#设置库的安装位置</span><br><span class="line">#TARGETS指定要安装的目标 LIBRARY代表要安装的是库文件 DESTINATION则是要安装的目标位置</span><br><span class="line">#这里的路径会把前面设置的安装前缀加在一起</span><br><span class="line"></span><br><span class="line">install(TARGETS MyLibrary LIBRARY DESTINATION mylib)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#设置头文件的安装位置</span><br><span class="line">#FILES直接指定要安装的文件列表 $&#123;HEADER_FILES&#125;是前面存放库中头文件的变量</span><br><span class="line"></span><br><span class="line">install(FILES $&#123;HEADER_FILES&#125; DESTINATION mylib/include)</span><br></pre></td></tr></table></figure><h3 id="1-2-2-MyLibrary-global-h"><a href="#1-2-2-MyLibrary-global-h" class="headerlink" title="1.2.2 MyLibrary_global.h"></a>1.2.2 MyLibrary_global.h</h3><ul><li><p>主要用于处理共享库中的符号可见性</p></li><li><p>定义了一个宏 <code>MYLIBRARY_EXPORT</code>，用来决定哪些符号应该被导出或导入到库中</p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MYLIBRARY_GLOBAL_H作为一个变量来避免此头文件被重复包含</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MYLIBRARY_GLOBAL_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MYLIBRARY_GLOBAL_H</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//包含Qt的全局定义头文件</span></span><br><span class="line"><span class="comment">//这个头文件是必要的，因为它包含了宏Q_DECL_EXPORT和Q_DECL_IMPORT</span></span><br><span class="line"><span class="comment">//这两个宏用于控制 Qt 库中的符号可见性。</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtCore/qglobal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment">//根据MYLIBRARY_LIBRARY来定义符号导出还是导入</span></span><br><span class="line"><span class="comment">//构件库时可导出 使用库时可导入</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(MYLIBRARY_LIBRARY)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#  <span class="keyword">define</span> MYLIBRARY_EXPORT Q_DECL_EXPORT</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#  <span class="keyword">define</span> MYLIBRARY_EXPORT Q_DECL_IMPORT</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MYLIBRARY_GLOBAL_H</span></span></span><br></pre></td></tr></table></figure><h3 id="1-2-3-mylibrary-h"><a href="#1-2-3-mylibrary-h" class="headerlink" title="1.2.3 mylibrary.h"></a>1.2.3 mylibrary.h</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MYLIBRARY_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MYLIBRARY_H</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyLibrary_global.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment">//前面定义MYLIBRARY_EXPORT来控制这个类内容的导入和导出</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MYLIBRARY_EXPORT</span> MyLibrary</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="built_in">MyLibrary</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getSum</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MYLIBRARY_H</span></span></span><br></pre></td></tr></table></figure><h3 id="1-2-4-mylibrary-cpp"><a href="#1-2-4-mylibrary-cpp" class="headerlink" title="1.2.4 mylibrary.cpp"></a>1.2.4 mylibrary.cpp</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mylibrary.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">MyLibrary::<span class="built_in">MyLibrary</span>()</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">MyLibrary::getSum</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a+b;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-3-CMake编译步骤"><a href="#1-3-CMake编译步骤" class="headerlink" title="1.3 CMake编译步骤"></a>1.3 CMake编译步骤</h2><p>1、cd到项目目录</p><p>2、添加文件夹<strong>build</strong>：<code>mkdir build</code></p><p>3、cd到build</p><p>4、<code>cmake ..</code></p><p>5、<code>make</code></p><p>6、（需要安装库和头文件时：<code>sudo make install</code>）</p><h1 id="2-编写CMake构建的可执行文件"><a href="#2-编写CMake构建的可执行文件" class="headerlink" title="2 编写CMake构建的可执行文件"></a>2 编写CMake构建的可执行文件</h1><h2 id="2-1-CMakeList-txt"><a href="#2-1-CMakeList-txt" class="headerlink" title="2.1 CMakeList.txt"></a>2.1 CMakeList.txt</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION <span class="number">3.5</span>)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">project(MyApp LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_INCLUDE_CURRENT_DIR ON)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_AUTOUIC ON)</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_AUTOMOC ON)</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_AUTORCC ON)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_CXX_STANDARD_REQUIRED ON)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">find_package(Qt5Core)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#以绝对路径在库的安装位置找到自己编写的库</span><br><span class="line">#LIBRARY_NAME作为变量存储库的名字 PATHS关键字指定绝对路径</span><br><span class="line"></span><br><span class="line">find_library(LIBRARY_NAME MyLibrary PATHS /home/hml/文档/test/mylib)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">#添加项目参与编译的文件</span><br><span class="line"></span><br><span class="line">add_executable(MyApp</span><br><span class="line"></span><br><span class="line">  main.cpp</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#链接Qt5的Core库和自己编写的库</span><br><span class="line"></span><br><span class="line">target_link_libraries(MyApp Qt5::Core $&#123;LIBRARY_NAME&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#以绝对路径将自己编写的库中的头文件添加进项目中</span><br><span class="line"></span><br><span class="line">target_include_directories(MyApp PRIVATE /home/hml/文档/test/mylib/include)</span><br></pre></td></tr></table></figure><h2 id="2-2-main-cpp"><a href="#2-2-main-cpp" class="headerlink" title="2.2  main.cpp"></a>2.2  main.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QCoreApplication&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mylibrary.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyLibrary_global.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">QCoreApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> x=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> y=<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//先创建库的类的实例化对象，再调用其中的成员函数</span></span><br><span class="line"></span><br><span class="line">    MyLibrary* lib=<span class="keyword">new</span> MyLibrary;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> z=lib-&gt;<span class="built_in">getSum</span>(x,y);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;z;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> lib;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.<span class="built_in">exec</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-补充：QMake构建库的方法"><a href="#3-补充：QMake构建库的方法" class="headerlink" title="3 补充：QMake构建库的方法"></a>3 补充：QMake构建库的方法</h1><h2 id="3-1-qmakelibrary-pro"><a href="#3-1-qmakelibrary-pro" class="headerlink" title="3.1 qmakelibrary.pro"></a>3.1 qmakelibrary.pro</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">#减去qt的一些默认配置，表示其不是一个qt的默认程序</span><br><span class="line"></span><br><span class="line">CONFIG -= qt</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">#指定项目模板为库</span><br><span class="line"></span><br><span class="line">TEMPLATE = lib</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">#添加预处理宏来记录是构建库还是使用库</span><br><span class="line"></span><br><span class="line">DEFINES += QMAKELIBRARY_LIBRARY</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#添加c++11的标准</span><br><span class="line"></span><br><span class="line">CONFIG += c++11</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">#添加预处理宏来警告已废弃了qt API</span><br><span class="line"></span><br><span class="line">DEFINES += QT_DEPRECATED_WARNINGS</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">#添加源文件</span><br><span class="line"></span><br><span class="line">SOURCES += \</span><br><span class="line"></span><br><span class="line">    qmakelibrary.cpp</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">#添加头文件</span><br><span class="line"></span><br><span class="line">HEADERS += \</span><br><span class="line"></span><br><span class="line">    qmakelibrary_global.h \</span><br><span class="line"></span><br><span class="line">    qmakelibrary.h</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">###############以下为安装设置################</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#针对unix系统的特定配置，设定库的目标安装路径</span><br><span class="line"></span><br><span class="line">unix &#123;</span><br><span class="line"></span><br><span class="line">    target.path = /home/hml/文档/test/mylib1</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">#如果库的目标路径不为空，则将库安装到目标路径</span><br><span class="line"></span><br><span class="line">!isEmpty(target.path): INSTALLS += target</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">#设置安装的头文件和库的目标路径</span><br><span class="line"></span><br><span class="line">#LIB_INSTALL_DIR = /home/hml/文档/test/mylib1</span><br><span class="line"></span><br><span class="line">HEADERS_INSTALL_DIR = /home/hml/文档/test/mylib1/include</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#如果路径存在，则安装头文件到目标位置</span><br><span class="line"></span><br><span class="line">!isEmpty(HEADERS_INSTALL_DIR): INSTALLS += headers</span><br><span class="line"></span><br><span class="line">    headers.path = $$HEADERS_INSTALL_DIR</span><br><span class="line"></span><br><span class="line">    headers.files = $$HEADERS</span><br></pre></td></tr></table></figure><blockquote><p><strong>QMake</strong>安装时不会自动创建目录，需要<code>mkdir -p</code>手动创建</p></blockquote><h2 id="3-2-qmakelibrary-global-h"><a href="#3-2-qmakelibrary-global-h" class="headerlink" title="3.2 qmakelibrary_global.h"></a>3.2 qmakelibrary_global.h</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#ifndef QMAKELIBRARY_GLOBAL_H</span><br><span class="line"></span><br><span class="line">#define QMAKELIBRARY_GLOBAL_H</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//如果Windows和不同系统定义不同的Q_DECL_EXPORT和Q_DECL_IMPORT</span><br><span class="line"></span><br><span class="line">#if defined(_MSC_VER) || defined(WIN64) || defined(_WIN64) || defined(__WIN64__) || defined(WIN32) || defined(_WIN32) || defined(__WIN32__) || defined(__NT__)</span><br><span class="line"></span><br><span class="line">#  define Q_DECL_EXPORT __declspec(dllexport)</span><br><span class="line"></span><br><span class="line">#  define Q_DECL_IMPORT __declspec(dllimport)</span><br><span class="line"></span><br><span class="line">#else</span><br><span class="line"></span><br><span class="line">#  define Q_DECL_EXPORT     __attribute__((visibility(&quot;default&quot;)))</span><br><span class="line"></span><br><span class="line">#  define Q_DECL_IMPORT     __attribute__((visibility(&quot;default&quot;)))</span><br><span class="line"></span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">//下面和CMake一样</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#if defined(QMAKELIBRARY_LIBRARY)</span><br><span class="line"></span><br><span class="line">#  define QMAKELIBRARY_EXPORT Q_DECL_EXPORT</span><br><span class="line"></span><br><span class="line">#else</span><br><span class="line"></span><br><span class="line">#  define QMAKELIBRARY_EXPORT Q_DECL_IMPORT</span><br><span class="line"></span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">#endif // QMAKELIBRARY_GLOBAL_H</span><br></pre></td></tr></table></figure><h2 id="3-3-QMake编译步骤"><a href="#3-3-QMake编译步骤" class="headerlink" title="3.3 QMake编译步骤"></a>3.3 QMake编译步骤</h2><p>1、cd到项目目录</p><p>2、<code>qmake .pro文件名</code></p><p>3、<code>make</code></p><p>4、（需要安装库和头文件时：<code>sudo make install</code>）</p><h1 id="4-编写QMake构建的可执行文件"><a href="#4-编写QMake构建的可执行文件" class="headerlink" title="4 编写QMake构建的可执行文件"></a>4 编写QMake构建的可执行文件</h1><h2 id="4-1-qmakeapp-pro"><a href="#4-1-qmakeapp-pro" class="headerlink" title="4.1 qmakeapp.pro"></a>4.1 qmakeapp.pro</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">QT -= gui</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">CONFIG += c++11 console</span><br><span class="line"></span><br><span class="line">CONFIG -= app_bundle</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">DEFINES += QT_DEPRECATED_WARNINGS</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">SOURCES += \</span><br><span class="line"></span><br><span class="line">        main.cpp</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">#导入库和头文件</span><br><span class="line"></span><br><span class="line">#-L表示文件夹，-l表示文件夹下的具体的库的名字</span><br><span class="line"></span><br><span class="line">#$$PWD是当前项目目录</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">INCLUDEPATH+=/home/hml/文档/test/mylib1/include</span><br><span class="line"></span><br><span class="line">LIBS+=-L/home/hml/文档/test/mylib1 -lqmakelibrary</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">#根据不同系统设置安装路径</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">qnx: target.path = /tmp/$$&#123;TARGET&#125;/bin</span><br><span class="line"></span><br><span class="line">else: unix:!android: target.path = /opt/$$&#123;TARGET&#125;/bin</span><br><span class="line"></span><br><span class="line">!isEmpty(target.path): INSTALLS += target</span><br></pre></td></tr></table></figure><h2 id="4-2-main-cpp"><a href="#4-2-main-cpp" class="headerlink" title="4.2 main.cpp"></a>4.2 main.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QCoreApplication&gt;</span></span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;qmakelibrary.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;qmakelibrary_global.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">QCoreApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> x=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> y=<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//先创建库的类的实例化对象，再调用其中的成员函数</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    QMakeLibrary* lib=<span class="keyword">new</span> QMakeLibrary;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> z=lib-&gt;<span class="built_in">getSum</span>(x,y);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;z;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> lib;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.<span class="built_in">exec</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="5-补充：CMake将库和可执行文件绑定为一个工程"><a href="#5-补充：CMake将库和可执行文件绑定为一个工程" class="headerlink" title="5 补充：CMake将库和可执行文件绑定为一个工程"></a>5 补充：CMake将库和可执行文件绑定为一个工程</h1><p>1、创建一个文件夹，并将所有子项目放进来</p><p>2、在文件夹内添加相应的<strong>CMakeLists.txt</strong>并编写</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.5)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">project(libdemo_cmake LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">add_subdirectory(MyApp)</span><br><span class="line"></span><br><span class="line">add_subdirectory(MyLibrary)</span><br></pre></td></tr></table></figure><h1 id="6-源码地址"><a href="#6-源码地址" class="headerlink" title="6 源码地址"></a>6 源码地址</h1><ul><li><p><a href="https://gitee.com/waibibushixiaobabo/libdemo_cmake/tree/master">CMake版本</a></p></li><li><p><a href="https://gitee.com/waibibushixiaobabo/libdemo_qmake/tree/master">QMake版本</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> demo项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> demo </tag>
            
            <tag> Qt </tag>
            
            <tag> CMake </tag>
            
            <tag> QMake </tag>
            
            <tag> 库 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
